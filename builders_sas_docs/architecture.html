<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Builders‚ÄëSAS ‚Äì Documentaci√≥n de Arquitectura</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #0b1120;
      color: #e5e7eb;
      line-height: 1.6;
    }
    header {
      background: linear-gradient(135deg, #1d4ed8, #7c3aed);
      padding: 2rem 1.5rem;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    header h1 {
      margin: 0;
      font-size: 1.8rem;
    }
    header p {
      margin: 0.3rem 0 0;
      font-size: 0.95rem;
      opacity: 0.9;
    }
    .container {
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: 1.5rem;
      padding: 1.5rem;
    }
    nav {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 0.75rem;
      padding: 1rem;
      border: 1px solid rgba(148, 163, 184, 0.3);
      max-height: calc(100vh - 120px);
      overflow-y: auto;
      position: sticky;
      top: 96px;
    }
    nav h2 {
      font-size: 1rem;
      margin-top: 0;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
    }
    nav ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
      font-size: 0.9rem;
    }
    nav li {
      margin: 0.3rem 0;
    }
    nav a {
      color: #e5e7eb;
      text-decoration: none;
      display: block;
      padding: 0.25rem 0.4rem;
      border-radius: 0.4rem;
    }
    nav a:hover {
      background: rgba(59, 130, 246, 0.2);
    }
    main {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 0.75rem;
      padding: 1.5rem;
      border: 1px solid rgba(148, 163, 184, 0.3);
    }
    section {
      margin-bottom: 2rem;
    }
    section h2 {
      margin-top: 0;
      font-size: 1.4rem;
      color: #bfdbfe;
    }
    section h3 {
      font-size: 1.1rem;
      color: #e5e7eb;
      margin-top: 1rem;
    }
    code, pre {
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.85rem;
    }
    pre {
      background: #020617;
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      overflow-x: auto;
      border: 1px solid rgba(55, 65, 81, 0.9);
    }
    .tag {
      display: inline-block;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-right: 0.3rem;
    }
    .tag-async { background: rgba(34, 197, 94, 0.15); color: #bbf7d0; border: 1px solid rgba(34, 197, 94, 0.6); }
    .tag-cron { background: rgba(59, 130, 246, 0.15); color: #bfdbfe; border: 1px solid rgba(59, 130, 246, 0.6); }
    .tag-domain { background: rgba(249, 115, 22, 0.1); color: #fed7aa; border: 1px solid rgba(249, 115, 22, 0.6); }
    .tag-swagger { background: rgba(244, 234, 65, 0.12); color: #fef08a; border: 1px solid rgba(244, 234, 65, 0.7); }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      padding: 0.25rem 0.75rem;
      border: 1px solid rgba(148, 163, 184, 0.4);
      font-size: 0.8rem;
      margin-right: 0.25rem;
    }
    .pill span {
      font-size: 0.8rem;
    }
    a.inline-link {
      color: #93c5fd;
      text-decoration: underline;
      text-decoration-style: dotted;
    }
    @media (max-width: 900px) {
      .container {
        grid-template-columns: 1fr;
      }
      nav {
        position: static;
        max-height: none;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Builders‚ÄëSAS ‚Äì Documentaci√≥n de Arquitectura</h1>
    <p>Motor de solicitudes, √≥rdenes y notificaciones as√≠ncronas para proyectos de construcci√≥n.</p>
  </header>
  <div class="container">
    <nav>
      <h2>√çndice</h2>
      <ul>
        <li><a href="#vision">1. Visi√≥n General</a></li>
        <li><a href="#arquitectura">2. Arquitectura General</a></li>
        <li><a href="#modulos">3. M√≥dulos y Responsabilidades</a></li>
        <li><a href="#notificaciones">4. Notificaciones y Reintentos</a></li>
        <li><a href="#asincronia">5. Asincron√≠a y Concurrencia</a></li>
        <li><a href="#swagger">6. Documentaci√≥n de API (Swagger)</a></li>
        <li><a href="#uml">7. Diagramas UML</a></li>
        <li><a href="#uso">8. C√≥mo usar esta documentaci√≥n</a></li>
      </ul>
    </nav>
    <main>
      <section id="vision">
        <h2>1. Visi√≥n General</h2>
        <p>
          Builders‚ÄëSAS es una plataforma backend orientada a la gesti√≥n profesional de
          <strong>solicitudes de construcci√≥n</strong> que se convierten en
          <strong>√≥rdenes de construcci√≥n</strong> mediante procesos autom√°ticos,
          impulsados por <span class="pill"><span>CRON jobs</span></span>,
          <span class="pill"><span>notificaciones as√≠ncronas</span></span> y
          <span class="pill"><span>reintentos concurrentes</span></span>.
        </p>
        <p>
          No existen endpoints p√∫blicos para crear √≥rdenes manualmente.
          Las <code>ConstructionOrder</code> se generan de forma derivada a partir de
          <code>ConstructionRequest</code> en estado <code>APPROVED</code>.
        </p>
      </section>

      <section id="arquitectura">
        <h2>2. Arquitectura General</h2>
        <span class="tag tag-domain">Dominio</span>
        <span class="tag tag-cron">CRON</span>
        <span class="tag tag-async">Async</span>
        <pre><code>Usuario / Frontend
  ‚îÇ
  ‚îú‚îÄ‚îÄ POST /api/v1/construction-requests
  ‚ñº
ConstructionRequestService
  ‚îÇ   ‚îú‚îÄ Validaci√≥n
  ‚îÇ   ‚îú‚îÄ Persistencia
  ‚îÇ   ‚îî‚îÄ Notificaci√≥n de creaci√≥n
  ‚ñº
MorningCronService (07:00)
  ‚îÇ   ‚îú‚îÄ Lee requests APPROVED
  ‚îÇ   ‚îú‚îÄ Calcula fechas inicio/fin
  ‚îÇ   ‚îú‚îÄ Genera ConstructionOrder
  ‚îÇ   ‚îî‚îÄ Notifica inicio
  ‚ñº
NightCronService (22:00)
  ‚îÇ   ‚îú‚îÄ Detecta √≥rdenes que terminan HOY
  ‚îÇ   ‚îú‚îÄ Marca FINISHED
  ‚îÇ   ‚îî‚îÄ Notifica finalizaci√≥n
  ‚ñº
NotificationService (async + retries)
  ‚îÇ   ‚îú‚îÄ POST a Webhook externo
  ‚îÇ   ‚îú‚îÄ Reintentos
  ‚îÇ   ‚îî‚îÄ Storage en memoria
  ‚ñº
Frontend Angular (campana + modal de notificaciones)</code></pre>
      </section>

      <section id="modulos">
        <h2>3. M√≥dulos y Responsabilidades</h2>

        <h3>3.1 ConstructionRequestService</h3>
        <p>
          Expone la funcionalidad de alta de solicitudes y la transici√≥n entre estados
          <code>PENDING</code>, <code>APPROVED</code> y <code>REJECTED</code>.
        </p>
        <pre><code>1. POST /api/v1/construction-requests
2. Validaci√≥n de usuario, proyecto y tipo
3. Persistencia como PENDING
4. Construcci√≥n de NotificationDto (creation)
5. Env√≠o as√≠ncrono a NotificationService</code></pre>

        <h3>3.2 MorningCronService</h3>
        <span class="tag tag-cron">CRON</span>
        <p>
          Orquesta la creaci√≥n de √≥rdenes a partir de solicitudes aprobadas.
          La regla de fechas garantiza que cada nueva construcci√≥n
          comience el d√≠a siguiente de la solicitud o de la √∫ltima orden finalizada
          del mismo proyecto.
        </p>

        <h3>3.3 NightCronService</h3>
        <span class="tag tag-cron">CRON</span>
        <p>
          Cierra √≥rdenes cuando la fecha de fin coincide con la fecha actual,
          marc√°ndolas como <code>FINISHED</code> y generando notificaciones de cierre.
        </p>
      </section>

      <section id="notificaciones">
        <h2>4. Notificaciones y Reintentos</h2>
        <span class="tag tag-async">Async</span>
        <p>
          El subsistema de notificaciones se basa en un DTO liviano
          (<code>NotificationDto</code>) y un servicio que realiza env√≠os
          a un webhook externo utilizando <code>CompletableFuture</code> para evitar bloqueos.
        </p>
        <pre><code>Evento de negocio
  ‚îÇ
  ‚îú‚îÄ Construcci√≥n de NotificationDto
  ‚ñº
NotificationService.sendAsync(dto)
  ‚îÇ
  ‚îú‚îÄ Env√≠o HTTP a webhook (async)
  ‚îú‚îÄ Si error ‚Üí reintentos con backoff
  ‚îî‚îÄ Almacenamiento en NotificationStorage
  ‚ñº
Frontend ‚Üí GET /api/v1/notifications</code></pre>
      </section>

      <section id="asincronia">
        <h2>5. Asincron√≠a y Concurrencia</h2>
        <span class="tag tag-async">Async</span>
        <p>
          La asincron√≠a se logra mediante el uso sistem√°tico de
          <code>CompletableFuture</code> y pools de hilos dedicados.
          De este modo:
        </p>
        <ul>
          <li>Las peticiones HTTP no esperan a que el webhook responda.</li>
          <li>Los CRON jobs pueden procesar m√∫ltiples proyectos en paralelo.</li>
          <li>Los reintentos no afectan el tiempo de respuesta percibido por el usuario.</li>
        </ul>
      </section>

      <section id="swagger">
        <h2>6. Documentaci√≥n de API con Swagger / OpenAPI</h2>
        <span class="tag tag-swagger">Swagger</span>
        <p>
          La API est√° preparada para ser documentada mediante Swagger / OpenAPI.
          Con el backend levantado en <code>http://localhost:9090</code>,
          las rutas t√≠picas son:
        </p>
        <ul>
          <li><code>/swagger-ui.html</code> o <code>/swagger-ui/index.html</code> ‚Äì UI interactiva.</li>
          <li><code>/v3/api-docs</code> ‚Äì documento OpenAPI en JSON.</li>
        </ul>
        <p>
          Desde esta interfaz se pueden explorar endpoints de
          <strong>Construction Requests</strong>, <strong>Notifications</strong> y
          utilidades de <strong>CRON</strong> sin salir del navegador.
        </p>
      </section>

      <section id="uml">
        <h2>7. Diagramas UML</h2>
        <p>
          En la carpeta <code>docs/</code> del repositorio se incluyen archivos
          PlantUML:
        </p>
        <ul>
          <li><code>uml-domain.puml</code> ‚Äì diagrama de clases de dominio.</li>
          <li><code>uml-notifications-sequence.puml</code> ‚Äì diagrama de secuencia de notificaciones.</li>
        </ul>
        <p>
          Estos archivos pueden visualizarse en IntelliJ, VS Code
          o herramientas online, generando im√°genes PNG/SVG para documentaci√≥n adicional.
        </p>
      </section>

      <section id="uso">
        <h2>8. C√≥mo usar esta documentaci√≥n</h2>
        <p>
          Copia este archivo en la carpeta <code>docs/</code> de tu proyecto.
          Puedes abrirlo localmente en el navegador o publicarlo mediante
          GitHub Pages, una intranet corporativa o cualquier servidor est√°tico.
        </p>
        <p>
          Para una descripci√≥n m√°s extensa y en formato texto, revisa tambi√©n el
          archivo <code>README.md</code> que acompa√±a a este HTML.
        </p>
      </section>
    
<section id="autores" style="background: rgba(15,23,42,0.8); padding: 1.5rem; border-radius: 0.75rem; border: 1px solid rgba(250, 204, 21, 0.5); margin-top: 2rem;">
  <h2 style="color:#fbbf24;">Autores Oficiales del Proyecto</h2>
  <h3 style="color:#93c5fd;">üë®‚Äçüíº Ingeniero de Sistemas</h3>
  <p style="margin-left:1rem;">
    <strong>Henry Garc√≠a Ospina</strong><br>
    üìß Correo: <strong>henrygarciaospina@gmail.com</strong><br>
    üì± Celular: <strong>320 515 1194</strong>
  </p>
  <h3 style="color:#93c5fd;">üë®‚Äçüîß Ingeniero Electr√≥nico</h3>
  <p style="margin-left:1rem;">
    <strong>Luis Ramos</strong><br>
    üì± Celular: <strong>305 282 6587</strong>
  </p>
</section>

<section id="swagger-ui-uso" style="margin-top:2rem;">
  <h2>9. Swagger UI ‚Äì Documentaci√≥n Ejecutable de la API</h2>
  <p>
    Este proyecto incluye una versi√≥n preparada de <strong>Swagger UI</strong> que
    permite visualizar y explorar la API Builders‚ÄëSAS a partir del archivo
    <code>openapi.json</code>.
  </p>
  <h3>9.1. Estructura de carpetas</h3>
  <pre><code>docs/
  ‚îú‚îÄ‚îÄ README.md
  ‚îú‚îÄ‚îÄ architecture.html
  ‚îî‚îÄ‚îÄ swagger-ui/
       ‚îú‚îÄ‚îÄ index.html
       ‚îî‚îÄ‚îÄ openapi.json</code></pre>
  <h3>9.2. Uso paso a paso</h3>
  <ol>
    <li>Abre el archivo <code>docs/swagger-ui/index.html</code> en tu navegador.</li>
    <li>Swagger UI cargar√° autom√°ticamente el archivo <code>openapi.json</code>.</li>
    <li>En la interfaz ver√°s los endpoints organizados por tags: <em>Construction Requests</em>, <em>Notifications</em>, <em>Cron</em>.</li>
    <li>Haz clic en cualquier endpoint para ver par√°metros, ejemplos y respuestas.</li>
  </ol>
  <p>
    Los recursos CSS/JS de Swagger UI se cargan desde un CDN oficial, por lo que
    es recomendable tener conexi√≥n a Internet al abrir <code>index.html</code>.
  </p>
</section>

<section id="diagramas" style="margin-top:2rem;">
  <h2>10. Diagramas UML y Recursos Visuales</h2>
  <p>
    La documentaci√≥n puede complementarse con diagramas UML generados a partir de archivos
    <code>.puml</code> (PlantUML), permitiendo visualizar:
  </p>
  <ul>
    <li>Relaciones entre entidades de dominio (Project, ConstructionRequest, ConstructionOrder, NotificationDto).</li>
    <li>Secuencia de notificaciones as√≠ncronas desde el cliente hasta el webhook externo.</li>
  </ul>
  <p>
    Se recomienda exportar estos diagramas como im√°genes (PNG/SVG) y colocarlas en una carpeta
    <code>docs/img/</code>, enlaz√°ndolas desde este mismo documento o desde el README principal.
  </p>

  <div style="display:flex;flex-wrap:wrap;gap:1.5rem;margin-top:1rem;">
    <figure style="flex:1;min-width:260px;">
      <img src="./img/uml-domain.png" alt="Diagrama de Dominio Builders-SAS" style="max-width:100%;border-radius:0.75rem;border:1px solid rgba(148,163,184,0.6);">
      <figcaption style="font-size:0.85rem;color:#9ca3af;margin-top:0.3rem;">
        Diagrama de dominio (Project, ConstructionRequest, ConstructionOrder, NotificationService).
      </figcaption>
    </figure>
    <figure style="flex:1;min-width:260px;">
      <img src="./img/uml-notifications-sequence.png" alt="Diagrama de Secuencia de Notificaciones" style="max-width:100%;border-radius:0.75rem;border:1px solid rgba(148,163,184,0.6);">
      <figcaption style="font-size:0.85rem;color:#9ca3af;margin-top:0.3rem;">
        Flujo de notificaciones asincronas: User -> API -> NotificationService -> Webhook -> NotificationStorage.
      </figcaption>
    </figure>
  </div>

</section>

    </main>
  </div>
</body>
</html>
